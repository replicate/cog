---
name: PyPI package

# Publishes the cog SDK to PyPI.
# Called by release-publish.yaml after coglet is published.
#
# TODO: Merge back into release-publish.yaml once PyPI
# Trusted Publisher config is updated to use that filename.

on:
  workflow_call:
    inputs:
      tag:
        description: "Release tag (e.g., v0.17.0)"
        required: true
        type: string

permissions:
  contents: read
  id-token: write
  attestations: write

jobs:
  publish-pypi-sdk:
    name: Publish SDK to PyPI
    runs-on: ubuntu-latest
    environment: pypi
    timeout-minutes: 10
    steps:
      - name: Download SDK wheel from release
        uses: robinraju/release-downloader@v1
        with:
          tag: ${{ inputs.tag }}
          fileName: "cog-*.whl"
          out-file-path: dist

      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
