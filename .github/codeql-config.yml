# CodeQL configuration for cog repository
# See: https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/customizing-your-advanced-setup-for-code-scanning

name: "Cog CodeQL Config"

# Paths to ignore during analysis
paths-ignore:
  # Test fixtures and generated code
  - "test-integration/test_integration/fixtures/**"
  - "**/*_test.go"

# Query filters to exclude specific false positive alerts
# See: https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/customizing-your-advanced-setup-for-code-scanning#excluding-specific-queries-from-analysis
#
# IMPORTANT: This config must be on the default branch (main) to affect PR checks.
# CodeQL compares PR scans against the default branch baseline.
#
# Excluded alerts and rationale:
#
# go/path-injection - Path injection alerts in coglet:
#   - coglet/internal/runner/runner.go: os.WriteFile(requestPath, ...) and os.Stat(requestPath)
#     Rationale: requestPath is constructed from controlled workingdir (set by runner manager)
#     plus internally-generated prediction ID (format: request-{id}.json). The prediction ID
#     is not user input - it's generated by PredictionID() using secure random bytes.
#
#   - coglet/internal/runner/procedure.go: os.Stat(u.Path) for file:// URLs
#     Rationale: file:// URLs are only used in development/testing for local procedure sources.
#     In production, procedures are fetched via http/https from trusted sources. The file://
#     scheme is an internal mechanism, not exposed to external users.
#
query-filters:
  - exclude:
      id: go/path-injection
