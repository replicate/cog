
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../yaml/">
      
      
        <link rel="next" href="../training/">
      
      
        
      
      
      <link rel="icon" href="../favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Prediction API - Cog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prediction-interface-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cog" class="md-header__button md-logo" aria-label="Cog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1s.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Prediction API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/replicate/cog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cog" class="md-nav__button md-logo" aria-label="Cog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1s.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64z"/></svg>

    </a>
    Cog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/replicate/cog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    README
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started-own-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using your own model
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy your model
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YAML spec
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Prediction API
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Prediction API
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basepredictor" class="md-nav__link">
    <span class="md-ellipsis">
      
        BasePredictor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#predictorsetup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictor.setup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictorpredictkwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictor.predict(**kwargs)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-predictors-and-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      
        async predictors and concurrency
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inputkwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input(**kwargs)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecating-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprecating inputs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#returning-an-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returning an object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returning-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returning a list
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recording-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recording metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accumulation-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accumulation modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dot-path-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dot-path keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cancellation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cancellation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cancelationexception" class="md-nav__link">
    <span class="md-ellipsis">
      
        CancelationException
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-and-output-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input and output types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file" class="md-nav__link">
    <span class="md-ellipsis">
      
        File()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path" class="md-nav__link">
    <span class="md-ellipsis">
      
        Path()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secret
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    <span class="md-ellipsis">
      
        List
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../http/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment variables
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../private-package-registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Private registry
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wsl2/wsl2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/replicate/cog/blob/main/LICENSE" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llms.txt" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    llms.txt
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basepredictor" class="md-nav__link">
    <span class="md-ellipsis">
      
        BasePredictor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BasePredictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#predictorsetup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictor.setup()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictorpredictkwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictor.predict(**kwargs)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-predictors-and-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      
        async predictors and concurrency
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inputkwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input(**kwargs)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecating-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprecating inputs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#returning-an-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returning an object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returning-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returning a list
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recording-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recording metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accumulation-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accumulation modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dot-path-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dot-path keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cancellation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cancellation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cancelationexception" class="md-nav__link">
    <span class="md-ellipsis">
      
        CancelationException
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-and-output-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input and output types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file" class="md-nav__link">
    <span class="md-ellipsis">
      
        File()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path" class="md-nav__link">
    <span class="md-ellipsis">
      
        Path()
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secret
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list" class="md-nav__link">
    <span class="md-ellipsis">
      
        List
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/replicate/cog/edit/main/docs/python.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="prediction-interface-reference">Prediction interface reference<a class="headerlink" href="#prediction-interface-reference" title="Permanent link">#</a></h1>
<p>This document defines the API of the <code>cog</code> Python module, which is used to define the interface for running predictions on your model.</p>
<blockquote>
<p>[!TIP]
Run <a href="../getting-started-own-model/#initialization"><code>cog init</code></a> to generate an annotated <code>predict.py</code> file that can be used as a starting point for setting up your model.</p>
<p>[!TIP]
Using a language model to help you write the code for your new Cog model?</p>
<p>Feed it <a href="https://cog.run/llms.txt">https://cog.run/llms.txt</a>, which has all of Cog's documentation bundled into a single file. To learn more about this format, check out <a href="https://llmstxt.org">llmstxt.org</a>.</p>
</blockquote>
<h2 id="contents">Contents<a class="headerlink" href="#contents" title="Permanent link">#</a></h2>
<ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#basepredictor"><code>BasePredictor</code></a></li>
<li><a href="#predictorsetup"><code>Predictor.setup()</code></a></li>
<li><a href="#predictorpredictkwargs"><code>Predictor.predict(**kwargs)</code></a></li>
<li><a href="#async-predictors-and-concurrency"><code>async</code> predictors and concurrency</a></li>
<li><a href="#inputkwargs"><code>Input(**kwargs)</code></a></li>
<li><a href="#deprecating-inputs">Deprecating inputs</a></li>
<li><a href="#output">Output</a></li>
<li><a href="#returning-an-object">Returning an object</a></li>
<li><a href="#returning-a-list">Returning a list</a></li>
<li><a href="#optional-properties">Optional properties</a></li>
<li><a href="#streaming-output">Streaming output</a></li>
<li><a href="#metrics">Metrics</a></li>
<li><a href="#recording-metrics">Recording metrics</a></li>
<li><a href="#accumulation-modes">Accumulation modes</a></li>
<li><a href="#dot-path-keys">Dot-path keys</a></li>
<li><a href="#type-safety">Type safety</a></li>
<li><a href="#cancellation">Cancellation</a></li>
<li><a href="#cancelationexception"><code>CancelationException</code></a></li>
<li><a href="#input-and-output-types">Input and output types</a></li>
<li><a href="#file"><code>File()</code></a></li>
<li><a href="#path"><code>Path()</code></a></li>
<li><a href="#secret"><code>Secret</code></a></li>
<li><a href="#optional"><code>Optional</code></a></li>
<li><a href="#list"><code>List</code></a></li>
</ul>
<h2 id="basepredictor"><code>BasePredictor</code><a class="headerlink" href="#basepredictor" title="Permanent link">#</a></h2>
<p>You define how Cog runs predictions on your model by defining a class that inherits from <code>BasePredictor</code>. It looks something like this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Input</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the model into memory to make running multiple predictions efficient&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;weights.pth&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Image to enlarge&quot;</span><span class="p">),</span>
            <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Factor to scale image by&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a single prediction on the model&quot;&quot;&quot;</span>
        <span class="c1"># ... pre-processing ...</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># ... post-processing ...</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
<p>Your Predictor class should define two methods: <code>setup()</code> and <code>predict()</code>.</p>
<h3 id="predictorsetup"><code>Predictor.setup()</code><a class="headerlink" href="#predictorsetup" title="Permanent link">#</a></h3>
<p>Prepare the model so multiple predictions run efficiently.</p>
<p>Use this <em>optional</em> method to include expensive one-off operations like loading trained models, instantiating data transformations, etc.</p>
<p>Many models use this method to download their weights (e.g. using <a href="https://github.com/replicate/pget"><code>pget</code></a>). This has some advantages:</p>
<ul>
<li>Smaller image sizes</li>
<li>Faster build times</li>
<li>Faster pushes and inference on <a href="https://replicate.com">Replicate</a></li>
</ul>
<p>However, this may also significantly increase your <code>setup()</code> time.</p>
<p>As an alternative, some choose to store their weights directly in the image. You can simply leave your weights in the directory alongside your <code>cog.yaml</code> and ensure they are not excluded in your <code>.dockerignore</code> file.</p>
<p>While this will increase your image size and build time, it offers other advantages:</p>
<ul>
<li>Faster <code>setup()</code> time</li>
<li>Ensures idempotency and reduces your model's reliance on external systems</li>
<li>Preserves reproducibility as your model will be self-contained in the image</li>
</ul>
<blockquote>
<p>When using this method, you should use the <code>--separate-weights</code> flag on <code>cog build</code> to store weights in a <a href="https://github.com/replicate/cog/blob/12ac02091d93beebebed037f38a0c99cd8749806/docs/getting-started.md?plain=1#L219">separate layer</a>.</p>
</blockquote>
<h3 id="predictorpredictkwargs"><code>Predictor.predict(**kwargs)</code><a class="headerlink" href="#predictorpredictkwargs" title="Permanent link">#</a></h3>
<p>Run a single prediction.</p>
<p>This <em>required</em> method is where you call the model that was loaded during <code>setup()</code>, but you may also want to add pre- and post-processing code here.</p>
<p>The <code>predict()</code> method takes an arbitrary list of named arguments, where each argument name must correspond to an <a href="#inputkwargs"><code>Input()</code></a> annotation.</p>
<p><code>predict()</code> can return strings, numbers, <a href="#path"><code>cog.Path</code></a> objects representing files on disk, or lists or dicts of those types. You can also define a custom <a href="#outputbasemodel"><code>Output()</code></a> for more complex return types.</p>
<h2 id="async-predictors-and-concurrency"><code>async</code> predictors and concurrency<a class="headerlink" href="#async-predictors-and-concurrency" title="Permanent link">#</a></h2>
<blockquote>
<p>Added in cog 0.14.0.</p>
</blockquote>
<p>You may specify your <code>predict()</code> method as <code>async def predict(...)</code>.  In
addition, if you have an async <code>predict()</code> function you may also have an async
<code>setup()</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;async setup is also supported...&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;async predict&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">&quot;hello world&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Models that have an async <code>predict()</code> function can run predictions concurrently, up to the limit specified by <a href="../yaml/#max"><code>concurrency.max</code></a> in cog.yaml. Attempting to exceed this limit will return a 409 Conflict response.</p>
<h2 id="inputkwargs"><code>Input(**kwargs)</code><a class="headerlink" href="#inputkwargs" title="Permanent link">#</a></h2>
<p>Use cog's <code>Input()</code> function to define each of the parameters in your <code>predict()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Image to enlarge&quot;</span><span class="p">),</span>
            <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Factor to scale image by&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</code></pre></div>
<p>The <code>Input()</code> function takes these keyword arguments:</p>
<ul>
<li><code>description</code>: A description of what to pass to this input for users of the model.</li>
<li><code>default</code>: A default value to set the input to. If this argument is not passed, the input is required. If it is explicitly set to <code>None</code>, the input is optional.</li>
<li><code>ge</code>: For <code>int</code> or <code>float</code> types, the value must be greater than or equal to this number.</li>
<li><code>le</code>: For <code>int</code> or <code>float</code> types, the value must be less than or equal to this number.</li>
<li><code>min_length</code>: For <code>str</code> types, the minimum length of the string.</li>
<li><code>max_length</code>: For <code>str</code> types, the maximum length of the string.</li>
<li><code>regex</code>: For <code>str</code> types, the string must match this regular expression.</li>
<li><code>choices</code>: For <code>str</code> or <code>int</code> types, a list of possible values for this input.</li>
<li><code>deprecated</code>: (optional) If set to <code>True</code>, marks this input as deprecated. Deprecated inputs will still be accepted, but tools and UIs may warn users that the input is deprecated and may be removed in the future. See <a href="#deprecating-inputs">Deprecating inputs</a>.</li>
</ul>
<p>Each parameter of the <code>predict()</code> method must be annotated with a type like <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, etc. See <a href="#input-and-output-types">Input and output types</a> for the full list of supported types.</p>
<p>Using the <code>Input</code> function provides better documentation and validation constraints to the users of your model, but it is not strictly required. You can also specify default values for your parameters using plain Python, or omit default assignment entirely:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default prompt&quot;</span><span class="p">,</span> <span class="c1"># this is valid</span>
        <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span>                 <span class="c1"># also valid</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># ...</span>
</code></pre></div>
<h2 id="deprecating-inputs">Deprecating inputs<a class="headerlink" href="#deprecating-inputs" title="Permanent link">#</a></h2>
<p>You can mark an input as deprecated by passing <code>deprecated=True</code> to the <code>Input()</code> function. Deprecated inputs will still be accepted, but tools and UIs may warn users that the input is deprecated and may be removed in the future.</p>
<p>This is useful when you want to phase out an input without breaking existing clients immediately:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Input</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Some deprecated text&quot;</span><span class="p">,</span> <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Prompt for the model&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># ...</span>
        <span class="k">return</span> <span class="n">prompt</span>
</code></pre></div>
<h2 id="output">Output<a class="headerlink" href="#output" title="Permanent link">#</a></h2>
<p>Cog predictors can return a simple data type like a string, number, float, or boolean. Use Python's <code>-&gt; &lt;type&gt;</code> syntax to annotate the return type.</p>
<p>Here's an example of a predictor that returns a string:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span>
</code></pre></div>
<h3 id="returning-an-object">Returning an object<a class="headerlink" href="#returning-an-object" title="Permanent link">#</a></h3>
<p>To return a complex object with multiple values, define an <code>Output</code> object with multiple fields to return from your <code>predict()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">File</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Output</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">File</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Each of the output object's properties must be one of the supported output types. For the full list, see <a href="#input-and-output-types">Input and output types</a>. Also, make sure to name the output class as <code>Output</code> and nothing else.</p>
<h3 id="returning-a-list">Returning a list<a class="headerlink" href="#returning-a-list" title="Permanent link">#</a></h3>
<p>The <code>predict()</code> method can return a list of any of the supported output types. Here's an example that outputs multiple files:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">):</span>
            <span class="n">out_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tmp/out-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">out_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
<p>Files are named in the format <code>output.&lt;index&gt;.&lt;extension&gt;</code>, e.g. <code>output.0.txt</code>, <code>output.1.txt</code>, and <code>output.2.txt</code> from the example above.</p>
<h3 id="optional-properties">Optional properties<a class="headerlink" href="#optional-properties" title="Permanent link">#</a></h3>
<p>To conditionally omit properties from the Output object, define them using <code>typing.Optional</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Output</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">))</span>
</code></pre></div>
<h3 id="streaming-output">Streaming output<a class="headerlink" href="#streaming-output" title="Permanent link">#</a></h3>
<p>Cog models can stream output as the <code>predict()</code> method is running. For example, a language model can output tokens as they're being generated and an image generation model can output images as they are being generated.</p>
<p>To support streaming output in your Cog model, add <code>from typing import Iterator</code> to your predict.py file. The <code>typing</code> package is a part of Python's standard library so it doesn't need to be installed. Then add a return type annotation to the <code>predict()</code> method in the form <code>-&gt; Iterator[&lt;type&gt;]</code> where <code>&lt;type&gt;</code> can be one of <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, or <code>cog.Path</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">do_stuff</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</code></pre></div>
<p>If you have an <a href="#async-predictors-and-concurrency">async <code>predict()</code> method</a>, you must use <code>cog.AsyncIterator</code> instead:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIterator</span><span class="p">,</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">do_stuff</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</code></pre></div>
<p>If you're streaming text output, you can use <code>ConcatenateIterator</code> to hint that the output should be concatenated together into a single string. This is useful on Replicate to display the output as a string instead of a list of strings.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">ConcatenateIterator</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConcatenateIterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;The&quot;</span><span class="p">,</span> <span class="s2">&quot;quick&quot;</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="s2">&quot;fox&quot;</span><span class="p">,</span> <span class="s2">&quot;jumps&quot;</span><span class="p">,</span> <span class="s2">&quot;over&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;lazy&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">token</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
</code></pre></div>
<p>Or for async <code>predict()</code> methods, use <code>AsyncConcatenateIterator</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">AsyncConcatenateIterator</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncConcatenateIterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;The&quot;</span><span class="p">,</span> <span class="s2">&quot;quick&quot;</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="s2">&quot;fox&quot;</span><span class="p">,</span> <span class="s2">&quot;jumps&quot;</span><span class="p">,</span> <span class="s2">&quot;over&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;lazy&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">token</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
</code></pre></div>
<h2 id="metrics">Metrics<a class="headerlink" href="#metrics" title="Permanent link">#</a></h2>
<p>You can record custom metrics from your <code>predict()</code> function to track model-specific data like token counts, timing breakdowns, or confidence scores. Metrics are included in the prediction response alongside the output.</p>
<h3 id="recording-metrics">Recording metrics<a class="headerlink" href="#recording-metrics" title="Permanent link">#</a></h3>
<p>Use <code>self.record_metric()</code> inside your <code>predict()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<p>For advanced use (dict-style access, deleting metrics), use <code>self.scope</code>:</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;token_count&quot;</span><span class="p">]</span>
</code></pre></div>
<p>Metrics appear in the prediction response <code>metrics</code> field:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;succeeded&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;token_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;predict_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.23</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>predict_time</code> metric is always added automatically by the runtime. If you set <code>predict_time</code> yourself, the runtime value takes precedence.</p>
<p>Supported value types are <code>bool</code>, <code>int</code>, <code>float</code>, <code>str</code>, <code>list</code>, and <code>dict</code>. Setting a metric to <code>None</code> deletes it.</p>
<h3 id="accumulation-modes">Accumulation modes<a class="headerlink" href="#accumulation-modes" title="Permanent link">#</a></h3>
<p>By default, recording a metric replaces any previous value for that key. You can use accumulation modes to build up values across multiple calls:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Increment a counter (adds to the existing numeric value)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;incr&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;token_count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;incr&quot;</span><span class="p">)</span>
<span class="c1"># Result: {&quot;token_count&quot;: 2}</span>

<span class="c1"># Append to an array</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span> <span class="s2">&quot;inference&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">)</span>
<span class="c1"># Result: {&quot;steps&quot;: [&quot;preprocessing&quot;, &quot;inference&quot;]}</span>

<span class="c1"># Replace (default behavior)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;running&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
<span class="c1"># Result: {&quot;status&quot;: &quot;done&quot;}</span>
</code></pre></div>
<p>The <code>mode</code> parameter accepts <code>"replace"</code> (default), <code>"incr"</code>, or <code>"append"</code>.</p>
<h3 id="dot-path-keys">Dot-path keys<a class="headerlink" href="#dot-path-keys" title="Permanent link">#</a></h3>
<p>Use dot-separated keys to create nested objects in the metrics output:</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;timing.preprocess&quot;</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;timing.inference&quot;</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">)</span>
</code></pre></div>
<p>This produces nested JSON:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;timing&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;preprocess&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.12</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;inference&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.85</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;predict_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.23</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="type-safety">Type safety<a class="headerlink" href="#type-safety" title="Permanent link">#</a></h3>
<p>Once a metric key has been assigned a value of a certain type, it cannot be changed to a different type without deleting it first. This prevents accidental type mismatches when using accumulation modes:</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># This would raise an error  &quot;count&quot; is an int, not a string:</span>
<span class="c1"># self.record_metric(&quot;count&quot;, &quot;oops&quot;)</span>

<span class="c1"># Delete first, then set with new type:</span>
<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">record_metric</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;now a string&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Outside an active prediction, <code>self.record_metric()</code> and <code>self.scope</code> are silent no-ops  no need for <code>None</code> checks.</p>
<h2 id="cancellation">Cancellation<a class="headerlink" href="#cancellation" title="Permanent link">#</a></h2>
<p>When a prediction is canceled (via the <a href="../http/#post-predictionsprediction_idcancel">cancel HTTP endpoint</a> or a dropped connection), the Cog runtime interrupts the running <code>predict()</code> function. The exception raised depends on whether the predictor is sync or async:</p>
<table>
<thead>
<tr>
<th>Predictor type</th>
<th>Exception raised</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sync (<code>def predict</code>)</td>
<td><code>CancelationException</code></td>
</tr>
<tr>
<td>Async (<code>async def predict</code>)</td>
<td><code>asyncio.CancelledError</code></td>
</tr>
</tbody>
</table>
<h3 id="cancelationexception"><code>CancelationException</code><a class="headerlink" href="#cancelationexception" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancelationException</span>
</code></pre></div>
<p><code>CancelationException</code> is raised in <strong>sync</strong> predictors when a prediction is cancelled. It is a <code>BaseException</code> subclass  <strong>not</strong> an <code>Exception</code> subclass. This means bare <code>except Exception</code> blocks in your predict code will not accidentally catch it, matching the behavior of <code>KeyboardInterrupt</code> and <code>asyncio.CancelledError</code>.</p>
<p>You do <strong>not</strong> need to handle this exception in normal predictor code  the runtime manages cancellation automatically. However, if you need to run cleanup logic when a prediction is cancelled, you can catch it explicitly:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">CancelationException</span><span class="p">,</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CancelationException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
            <span class="k">raise</span>  <span class="c1"># always re-raise</span>
</code></pre></div>
<blockquote>
<p>[!WARNING]
You <strong>must</strong> re-raise <code>CancelationException</code> after cleanup. Swallowing it will prevent the runtime from marking the prediction as canceled, and may result in the termination of the container.</p>
</blockquote>
<p><code>CancelationException</code> is available as:</p>
<ul>
<li><code>cog.CancelationException</code> (recommended)</li>
<li><code>cog.exceptions.CancelationException</code></li>
</ul>
<p>For <strong>async</strong> predictors, cancellation follows standard Python async conventions and raises <code>asyncio.CancelledError</code> instead.</p>
<h2 id="input-and-output-types">Input and output types<a class="headerlink" href="#input-and-output-types" title="Permanent link">#</a></h2>
<p>Each parameter of the <code>predict()</code> method must be annotated with a type. The method's return type must also be annotated. The supported types are:</p>
<ul>
<li><code>str</code>: a string</li>
<li><code>int</code>: an integer</li>
<li><code>float</code>: a floating point number</li>
<li><code>bool</code>: a boolean</li>
<li><a href="#file"><code>cog.File</code></a>: a file-like object representing a file</li>
<li><a href="#path"><code>cog.Path</code></a>: a path to a file on disk</li>
<li><a href="#secret"><code>cog.Secret</code></a>: a string containing sensitive information</li>
</ul>
<h2 id="file"><code>File()</code><a class="headerlink" href="#file" title="Permanent link">#</a></h2>
<blockquote>
<p>[!WARNING]<br />
<code>cog.File</code> is deprecated and will be removed in a future version of Cog. Use <a href="#path"><code>cog.Path</code></a> instead.</p>
</blockquote>
<p>The <code>cog.File</code> object is used to get files in and out of models. It represents a <em>file handle</em>.</p>
<p>For models that return a <code>cog.File</code> object, the prediction output returned by Cog's built-in HTTP server will be a URL.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_image</span><span class="p">:</span> <span class="n">File</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Image to enlarge&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">File</span><span class="p">:</span>
        <span class="n">pillow_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">source_image</span><span class="p">)</span>
        <span class="n">upscaled_image</span> <span class="o">=</span> <span class="n">do_some_processing</span><span class="p">(</span><span class="n">pillow_img</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">File</span><span class="p">(</span><span class="n">upscaled_image</span><span class="p">)</span>
</code></pre></div>
<h2 id="path"><code>Path()</code><a class="headerlink" href="#path" title="Permanent link">#</a></h2>
<p>The <code>cog.Path</code> object is used to get files in and out of models. It represents a <em>path to a file on disk</em>.</p>
<p><code>cog.Path</code> is a subclass of Python's <a href="https://docs.python.org/3/library/pathlib.html#basic-use"><code>pathlib.Path</code></a> and can be used as a drop-in replacement.</p>
<p>For models that return a <code>cog.Path</code> object, the prediction output returned by Cog's built-in HTTP server will be a URL.</p>
<p>This example takes an input file, resizes it, and returns the resized image:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Image to enlarge&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="n">upscaled_image</span> <span class="o">=</span> <span class="n">do_some_processing</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># To output `cog.Path` objects the file needs to exist, so create a temporary file first.</span>
        <span class="c1"># This file will automatically be deleted by Cog after it has been returned.</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">())</span> <span class="o">/</span> <span class="s2">&quot;upscaled.png&quot;</span>
        <span class="n">upscaled_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</code></pre></div>
<h2 id="secret"><code>Secret</code><a class="headerlink" href="#secret" title="Permanent link">#</a></h2>
<p>The <code>cog.Secret</code> type is used to signify that an input holds sensitive information,
like a password or API token.</p>
<p><code>cog.Secret</code> is a type that redacts its contents in string representations to prevent accidental disclosure.
You can access its contents with the <code>get_secret_value()</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cog</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePredictor</span><span class="p">,</span> <span class="n">Secret</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_token</span><span class="p">:</span> <span class="n">Secret</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Prints &#39;**********&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>        

        <span class="c1"># Use get_secret_value method to see the secret&#39;s content.</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">api_token</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
</code></pre></div>
<p>A predictor's <code>Secret</code> inputs are represented in OpenAPI with the following schema:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;x-cog-secret&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Models uploaded to Replicate treat secret inputs differently throughout its system.
When you create a prediction on Replicate,
any value passed to a <code>Secret</code> input is redacted after being sent to the model.</p>
<blockquote>
<p>[!WARNING]<br />
Passing secret values to untrusted models can result in 
unintended disclosure, exfiltration, or misuse of sensitive data.</p>
</blockquote>
<h2 id="optional"><code>Optional</code><a class="headerlink" href="#optional" title="Permanent link">#</a></h2>
<p>Optional inputs should be explicitly defined as <code>Optional[T]</code> so that type checker can warn us about error-prone <code>None</code> values.</p>
<p>For example, the following code might fail if <code>prompt</code> is not specified in the inputs:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span> <span class="o">+</span> <span class="n">prompt</span>  <span class="c1"># TypeError: can only concatenate str (not &quot;NoneType&quot;) to str</span>
</code></pre></div>
<p>We can improve it by making <code>prompt</code> an <code>Optional[str]</code>. Note that <code>default=None</code> is now redundant as <code>Optional</code> implies it.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="n">Input</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;prompt&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type check can warn us if we forget this</span>
            <span class="k">return</span> <span class="s2">&quot;hello&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;hello&quot;</span> <span class="o">+</span> <span class="n">prompt</span>
</code></pre></div>
<p>Note that the error prone usage of <code>prompt: str=Input(default=None)</code> might throw an error in a future release of Cog.</p>
<h2 id="list"><code>List</code><a class="headerlink" href="#list" title="Permanent link">#</a></h2>
<p>The List type is also supported in inputs. It can hold any supported type.</p>
<p>Example for <strong>List[Path]</strong>:
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Predictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
       <span class="n">output_parts</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Use a list to collect file contents</span>
       <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
           <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
             <span class="n">output_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
       <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_parts</span><span class="p">)</span>
</code></pre></div>
The corresponding cog command:
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>test1<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1</span>.txt
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>test2<span class="w"> </span>&gt;<span class="w"> </span><span class="m">2</span>.txt
$<span class="w"> </span>cog<span class="w"> </span>predict<span class="w"> </span>-i<span class="w"> </span><span class="nv">paths</span><span class="o">=</span>@1.txt<span class="w"> </span>-i<span class="w"> </span><span class="nv">paths</span><span class="o">=</span>@2.txt
Running<span class="w"> </span>prediction...
test1

test2
</code></pre></div>
- Note the repeated inputs with the same name "paths" which constitute the list</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Cog is an open-source project from <a href="https://replicate.com">Replicate</a>
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/replicate/cog" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.gg/replicate" target="_blank" rel="noopener" title="discord.gg" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.317 4.37a19.8 19.8 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.3 18.3 0 0 0-5.487 0 13 13 0 0 0-.617-1.25.08.08 0 0 0-.079-.037A19.7 19.7 0 0 0 3.677 4.37a.1.1 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.08.08 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.08.08 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13 13 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10 10 0 0 0 .372-.292.07.07 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.07.07 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.3 12.3 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.08.08 0 0 0 .084.028 19.8 19.8 0 0 0 6.002-3.03.08.08 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.06.06 0 0 0-.031-.03M8.02 15.33c-1.182 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418m7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/replicate" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.234 10.162 22.977 0h-2.072l-7.591 8.824L7.251 0H.258l9.168 13.343L.258 24H2.33l8.016-9.318L16.749 24h6.993zm-2.837 3.299-.929-1.329L3.076 1.56h3.182l5.965 8.532.929 1.329 7.754 11.09h-3.182z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/@replicatehq" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.498 6.186a3.02 3.02 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.02 3.02 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.02 3.02 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.02 3.02 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814M9.545 15.568V8.432L15.818 12z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.action.edit"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>