#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

# Clean old wheels to avoid embedding stale versions
rm -f "${ROOT_DIR}/dist/cog-"*.whl "${ROOT_DIR}/dist/coglet-"*.whl

mkdir -p "${ROOT_DIR}/dist"

# Build cog wheel
uv build --wheel --out-dir="${ROOT_DIR}/dist" "${ROOT_DIR}"

# Build coglet-server binary (required for coglet wheel)
"${SCRIPT_DIR}/build-coglet-server"

# Build coglet wheel
uv build --wheel --out-dir="${ROOT_DIR}/dist" "${ROOT_DIR}/coglet"
