# Test complex list input types (list of anthropic MessageParam)
# Skip for cog-dataclass and coglet_rust (test was only validated with fast build)
[cog_dataclass] skip
[coglet_rust] skip

# Build the image
cog build -t $TEST_IMAGE

# Predict with JSON list input for complex type
cog predict $TEST_IMAGE -i 'messages=[{"content": "Hi There", "role": "user"}, {"content": "I am a test", "role": "user"}]'
stdout 'Content: Hi There-I am a test'

-- cog.yaml --
build:
  python_version: "3.11"
  python_requirements: "requirements.txt"
predict: "predict.py:Predictor"

-- requirements.txt --
anthropic[vertex]==0.45.2

-- predict.py --
from anthropic.types import MessageParam
from cog import BasePredictor, Input
from cog.coder import json_coder  # noqa: F401

class Predictor(BasePredictor):
    test_inputs = {"messages": [{"content": "hello world"}]}

    def predict(
        self,
        messages: list[MessageParam] = Input(description="Messages API."),
    ) -> str:
        return "Content: " + "-".join([x["content"] for x in messages])
